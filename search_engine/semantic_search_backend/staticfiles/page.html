<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fashion Search</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<style>
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
background-color: #f5f5f5;
min-height: 100vh;
}

.search-container {
height: 100vh;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
padding: 20px;
transition: all 0.5s ease;
}

.search-container.results-shown {
height: auto;
padding-top: 50px;
}

.search-box {
width: 80%;
max-width: 600px;
position: relative;
margin-bottom: 40px;
}

.search-input {
width: 100%;
padding: 20px 60px 20px 30px;
border: none;
border-radius: 30px;
font-size: 18px;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
transition: all 0.3s ease;
}

.search-input:focus {
outline: none;
box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
}

.search-button {
position: absolute;
right: 20px;
top: 50%;
transform: translateY(-50%);
background: none;
border: none;
font-size: 20px;
color: #666;
cursor: pointer;
}

.products-grid {
display: grid;
grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
gap: 30px;
padding: 20px;
max-width: 1400px;
margin: 0 auto;
}

.product-card {
background: white;
border-radius: 15px;
overflow: hidden;
box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
transition: all 0.3s ease;
cursor: pointer;
}

.product-card:hover {
transform: translateY(-5px);
box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.product-image {
width: 100%;
height: 400px;
object-fit: cover;
}

.product-info {
padding: 20px;
}

.product-name {
font-size: 16px;
margin-bottom: 10px;
color: #333;
display: -webkit-box;
-webkit-line-clamp: 2;
-webkit-box-orient: vertical;
overflow: hidden;
}

.product-sizes {
display: flex;
flex-wrap: wrap;
gap: 8px;
}

.size-tag {
background: #f0f0f0;
padding: 5px 10px;
border-radius: 15px;
font-size: 14px;
color: #666;
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.8);
z-index: 1000;
overflow-y: auto;
}

.modal-content {
background: white;
width: 90%;
max-width: 1000px;
margin: 50px auto;
border-radius: 20px;
position: relative;
padding: 30px;
}

.close-modal {
position: absolute;
right: 20px;
top: 20px;
font-size: 24px;
cursor: pointer;
color: #666;
}

.modal-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 30px;
}

.modal-images {
display: grid;
grid-template-columns: repeat(3, 1fr);
gap: 10px;
}

.modal-image {
width: 100%;
aspect-ratio: 1;
object-fit: cover;
border-radius: 10px;
cursor: pointer;
}

.modal-image.selected {
border: 3px solid #007bff;
}

.modal-details {
padding: 20px;
}

.price-tag {
display: flex;
align-items: center;
gap: 10px;
margin-bottom: 20px;
}

.current-price {
font-size: 24px;
font-weight: bold;
color: #333;
}

.old-price {
font-size: 18px;
color: #999;
text-decoration: line-through;
}

.discount-badge {
background: #ff4444;
color: white;
padding: 5px 10px;
border-radius: 15px;
font-size: 14px;
}

.color-swatches {
display: flex;
gap: 10px;
margin-bottom: 20px;
}

.color-swatch {
width: 30px;
height: 30px;
border-radius: 50%;
border: 2px solid white;
box-shadow: 0 0 0 1px #ddd;
}

.loading-spinner {
display: none;
width: 50px;
height: 50px;
border: 5px solid #f3f3f3;
border-top: 5px solid #3498db;
border-radius: 50%;
animation: spin 1s linear infinite;
margin: 20px auto;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

@media (max-width: 768px) {
.modal-grid {
grid-template-columns: 1fr;
}

.modal-images {
grid-template-columns: repeat(2, 1fr);
}
}
</style>
</head>
<body>
<div class="search-container">
<div class="search-box">
<input type="text" class="search-input" placeholder="Search for clothes...">
<button class="search-button">
<i class="fas fa-search"></i>
</button>
</div>
<div class="loading-spinner"></div>
<div class="products-grid"></div>
</div>

<div class="modal">
<div class="modal-content animate__animated animate__fadeIn">
<span class="close-modal">&times;</span>
<div class="modal-grid">
<div class="modal-images"></div>
<div class="modal-details"></div>
</div>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
const searchContainer = document.querySelector('.search-container');
const searchInput = document.querySelector('.search-input');
const searchButton = document.querySelector('.search-button');
const productsGrid = document.querySelector('.products-grid');
const modal = document.querySelector('.modal');
const closeModal = document.querySelector('.close-modal');
const loadingSpinner = document.querySelector('.loading-spinner');

function showLoading() {
loadingSpinner.style.display = 'block';
productsGrid.innerHTML = '';
}

function hideLoading() {
loadingSpinner.style.display = 'none';
}

async function searchProducts(query) {
showLoading();
try {
const response = await fetch(`http://localhost:8000/api/search?query=${encodeURIComponent(query)}`);
const data = await response.json();
displayProducts(data);
} catch (error) {
console.error('Error fetching products:', error);
productsGrid.innerHTML = '<p>Error loading products. Please try again.</p>';
}
hideLoading();
}

function displayProducts(products) {
searchContainer.classList.add('results-shown');
productsGrid.innerHTML = '';

products.forEach(product => {
const card = document.createElement('div');
card.className = 'product-card animate__animated animate__fadeIn';

card.innerHTML = `
<img src="${product.images[0]}" alt="${product.name}" class="product-image">
<div class="product-info">
<h3 class="product-name">${product.name}</h3>
<div class="product-sizes">
${product.sizes.map(size => `<span class="size-tag">${size}</span>`).join('')}
</div>
</div>
`;

card.addEventListener('click', () => showProductDetails(product));
productsGrid.appendChild(card);
});
}

function showProductDetails(product) {
const modalImages = document.querySelector('.modal-images');
const modalDetails = document.querySelector('.modal-details');

modalImages.innerHTML = product.images.map((img, index) => `
<img src="${img}" alt="${product.name}" class="modal-image ${index === 0 ? 'selected' : ''}" 
onclick="this.parentElement.querySelectorAll('.modal-image').forEach(img => img.classList.remove('selected')); 
this.classList.add('selected');">
`).join('');

let details = `
<h2>${product.name}</h2>
<div class="price-tag">
<span class="current-price">${product.currency} ${product.current_price}</span>
${product.old_price ? `
<span class="old-price">${product.currency} ${product.old_price}</span>
<span class="discount-badge">${product.off_percent}% OFF</span>
` : ''}
</div>
`;

if (product.colors && product.colors.length > 0) {
details += `
<div class="color-swatches">
${product.colors.map(color => `
<div class="color-swatch" style="background-color: ${color}"></div>
`).join('')}
</div>
`;
}

const fields = {
'Description': product.description,
'Material': product.material,
'Brand': product.brand_name,
'Category': product.category_name,
'Gender': product.gender_name,
'Shop': product.shop_name,
'Status': product.status,
'Region': product.region
};

for (const [key, value] of Object.entries(fields)) {
if (value) {
details += `<p><strong>${key}:</strong> ${value}</p>`;
}
}

if (product.link) {
details += `
<a href="${product.link}" target="_blank" style="
display: inline-block;
margin-top: 20px;
padding: 10px 20px;
background: #007bff;
color: white;
text-decoration: none;
border-radius: 5px;
">View on Store</a>
`;
}

modalDetails.innerHTML = details;
modal.style.display = 'block';
}

closeModal.addEventListener('click', () => {
modal.style.display = 'none';
});

window.addEventListener('click', (event) => {
if (event.target === modal) {
modal.style.display = 'none';
}
});

searchButton.addEventListener('click', () => {
const query = searchInput.value.trim();
if (query) {
searchProducts(query);
}
});

searchInput.addEventListener('keypress', (e) => {
if (e.key === 'Enter') {
const query = searchInput.value.trim();
if (query) {
searchProducts(query);
}
}
});
});
</script>
</body>
</html>